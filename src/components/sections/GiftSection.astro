---
import { Image } from 'astro:assets';
import type { Language } from '@/lib/translations';
import { translations } from '@/lib/translations';

import giftTote from '@/assets/gift-tote.png';
import whatsappAvatar from '@/assets/whatsapp-avatar.jpg';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const t = translations[lang];
const isRTL = lang === 'ar';

const whatsappMessage = lang === "ar"
  ? "Ù…Ø±Ø­Ø¨Ø§! Ø¹Ù†Ø¯ÙŠ Ø³Ø¤Ø§Ù„ Ø¹Ù† Ù‡Ø¯ÙŠØ© Ø¨ÙŠÙ„Ø§ØªÙˆØ¨ÙŠØ§"
  : "Hi! I'd like to ask about Pilatopia gift";

const whatsappLink = `https://wa.me/966550614150?text=${encodeURIComponent(whatsappMessage)}`;

const occasions = isRTL
  ? ["Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯", "Ø°ÙƒØ±Ù‰ Ø³Ù†ÙˆÙŠØ©", "Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø¨", "Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø©", "Ø¹ÙŠØ¯ Ø§Ù„Ø£Ù…", "Ù„Ù‡Ø§"]
  : ["Birthday", "Anniversary", "Valentine's Day", "New Year's", "Mother's Day", "Her"];
---

<section id="gift-section" class="section-padding bg-white overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    <div class={`gift-layout ${isRTL ? 'direction-rtl' : ''}`}>
      <!-- Image Side -->
      <div class="gift-image-container relative animate-slide-in">
        <!-- Main Photo -->
        <div class="aspect-[4/5] rounded-3xl overflow-hidden relative bg-[var(--bg-cream)] shadow-2xl shadow-black/10">
          <Image
            src={giftTote}
            alt="Pilatopia Gift Tote"
            class="w-full h-full object-cover"
            widths={[300, 500, 700]}
            sizes="(max-width: 768px) 100vw, 40vw"
            format="webp"
            quality={80}
            loading="lazy"
          />
        </div>

        <!-- Floating accent - top corner -->
        <div class={`floating-accent absolute -top-4 ${isRTL ? '-left-4' : '-right-4'} bg-white rounded-2xl p-3 shadow-lg`}>
          <svg class="w-5 h-5 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
          </svg>
        </div>

        <!-- Floating accent - bottom corner (Pink flower) -->
        <div class={`floating-accent-alt absolute -bottom-4 ${isRTL ? '-right-4' : '-left-4'} bg-white rounded-2xl p-3 shadow-lg`}>
          <span class="text-xl">ğŸŒ¸</span>
        </div>
      </div>

      <!-- Content Side -->
      <div class="gift-content">
        <div class="inline-flex items-center gap-2 text-lg font-medium mb-6 animate-fade-up" style="--delay: 0.1s">
          <svg class="w-5 h-5 text-[#E39C82]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
          </svg>
          <span class="text-[var(--text-primary)]">{isRTL ? 'Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù€' : 'the perfect gift for'}</span>
          <span class="occasion-carousel relative inline-block w-36 h-7 overflow-hidden">
            {occasions.map((occasion, index) => (
              <span
                class="occasion-item absolute inset-0 font-bold text-[#E39C82]"
                data-index={index}
              >
                {occasion}
              </span>
            ))}
          </span>
        </div>

        <h2
          class="text-4xl sm:text-5xl font-medium text-[var(--text-primary)] leading-tight mb-6 animate-fade-up"
          style={`font-family: ${isRTL ? 'var(--font-body)' : 'var(--font-rufina), Georgia, serif'}; --delay: 0.2s`}
        >
          {t.gift.title} <span class={isRTL ? '' : 'italic'}>{t.gift.titleHighlight}</span>
        </h2>

        <p class="text-[var(--text-secondary)] mb-8 text-lg leading-relaxed max-w-lg animate-fade-up" style="--delay: 0.3s">
          {t.gift.subtitle}
        </p>

        <div class="mb-8 animate-fade-up" style="--delay: 0.4s">
          <p class="font-medium text-[var(--text-primary)] mb-4">{t.gift.includes}</p>
          <div class="grid grid-cols-2 gap-3">
            {t.gift.items.map((item, index) => (
              <div class="flex items-center gap-3">
                <div class="w-6 h-6 rounded-full bg-[var(--primary)]/20 flex items-center justify-center flex-shrink-0">
                  <svg class="w-3.5 h-3.5 text-[var(--primary-dark)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                </div>
                <span class="text-sm text-[var(--text-secondary)]">{item}</span>
              </div>
            ))}
          </div>
        </div>

        <!-- WhatsApp Contact Card -->
        <div class="animate-fade-up" style="--delay: 0.5s">
          <p class="text-sm text-[var(--text-secondary)] mb-2">
            {lang === 'ar' ? 'ØªÙˆØ§ØµÙ„ÙŠ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨' : 'Chat with us on WhatsApp'}
          </p>
          <div class="whatsapp-card inline-flex items-center gap-5 md:gap-6 border-2 border-gray-200 rounded-2xl px-5 md:px-6 py-4 hover:border-green-500/30 transition-colors bg-white shadow-sm">
            <div class="flex items-center gap-3 flex-shrink-0">
              <a
                href={whatsappLink}
                target="_blank"
                rel="noopener noreferrer"
                class="relative flex-shrink-0 hover:scale-105 transition-transform"
              >
                <Image
                  src={whatsappAvatar}
                  alt="Pilatopia"
                  class="w-12 h-12 rounded-full object-cover ring-2 ring-green-500/20"
                  width={48}
                  height={48}
                  format="webp"
                  quality={80}
                  loading="lazy"
                />
                <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center">
                  <svg viewBox="0 0 24 24" class="w-2.5 h-2.5 text-white" fill="currentColor">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                  </svg>
                </div>
              </a>
              <div>
                <h3 class="font-semibold text-[var(--text-primary)]">Pilatopia</h3>
                <a
                  href={whatsappLink}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-sm text-[var(--text-secondary)] hover:text-green-600 inline-flex items-center gap-1 transition-colors"
                  dir="ltr"
                >
                  0550614150
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
                <p class="text-xs text-green-600 font-medium mt-0.5">
                  {lang === 'ar' ? 'Ø¨Ù†Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø¯Ù‚Ø§ÙŠÙ‚!' : 'We reply in minutes!'}
                </p>
              </div>
            </div>

            <!-- QR Code - hidden on mobile -->
            <div class="hidden md:flex flex-col items-center gap-1 flex-shrink-0">
              <div class="bg-white p-1.5 rounded-lg border border-gray-200">
                <img
                  src={`https://api.qrserver.com/v1/create-qr-code/?size=70x70&data=${encodeURIComponent(whatsappLink)}`}
                  alt="WhatsApp QR"
                  class="w-16 h-16"
                  loading="lazy"
                />
              </div>
              <p class="text-xs text-[var(--text-secondary)]">
                {lang === 'ar' ? 'Ø§Ù…Ø³Ø­ÙŠ Ø§Ù„ÙƒÙˆØ¯' : 'Scan to chat'}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .animate-slide-in {
    animation: slideIn 0.7s ease-out both;
  }

  .animate-fade-up {
    animation: fadeUp 0.6s ease-out both;
    animation-delay: var(--delay, 0s);
  }

  .floating-accent {
    animation: float 3s ease-in-out infinite;
  }

  .floating-accent-alt {
    animation: floatAlt 4s ease-in-out infinite;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  [dir="rtl"] .animate-slide-in,
  .direction-rtl .animate-slide-in {
    animation-name: slideInRTL;
  }

  @keyframes slideInRTL {
    from {
      opacity: 0;
      transform: translateX(30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }

  @keyframes floatAlt {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(3px) rotate(5deg); }
    50% { transform: translateY(6px) rotate(0deg); }
    75% { transform: translateY(3px) rotate(-5deg); }
  }

  /* Occasion carousel */
  .occasion-item {
    opacity: 0;
    transform: translateY(20px);
    filter: blur(4px);
    transition: all 0.4s ease;
  }

  .occasion-item.active {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }

  .occasion-item.exit {
    opacity: 0;
    transform: translateY(-20px);
    filter: blur(4px);
  }
</style>

<script define:vars={{ occasionCount: occasions.length }}>
  let currentIndex = 0;
  const items = document.querySelectorAll('.occasion-item');

  function showNext() {
    items.forEach((item, i) => {
      item.classList.remove('active', 'exit');
      if (i === currentIndex) {
        item.classList.add('exit');
      }
    });

    currentIndex = (currentIndex + 1) % occasionCount;

    setTimeout(() => {
      items.forEach((item, i) => {
        item.classList.remove('exit');
        if (i === currentIndex) {
          item.classList.add('active');
        }
      });
    }, 50);
  }

  // Initialize first item
  if (items[0]) items[0].classList.add('active');

  // Rotate every 2 seconds
  setInterval(showNext, 2000);
</script>
